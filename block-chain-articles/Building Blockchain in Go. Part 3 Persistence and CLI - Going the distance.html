<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="generator" content="Hugo 0.97.3">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Ivan Kuznetsov">
  <meta property="og:url" content="https://jeiwan.net/posts/building-blockchain-in-go-part-3/">

  <title>Building Blockchain in Go. Part 3: Persistence and CLI - Going the distance</title>
  <meta property="og:title" content="Building Blockchain in Go. Part 3: Persistence and CLI - Going the distance">
  <meta property="og:type" content="article">
  <meta name="description" content="A blog about blockchains and smart contracts development">
  <meta name="keywords" content="bitcoin, ethereum, evm, smart contract, blockchain, programming, development, solidity, vyper">

  <link rel="stylesheet" href="Building%20Blockchain%20in%20Go.%20Part%203%20Persistence%20and%20CLI%20-%20Going%20the%20distance_files/css.css">
  <link rel="stylesheet" href="Building%20Blockchain%20in%20Go.%20Part%203%20Persistence%20and%20CLI%20-%20Going%20the%20distance_files/prism.css">
  <link rel="stylesheet" href="Building%20Blockchain%20in%20Go.%20Part%203%20Persistence%20and%20CLI%20-%20Going%20the%20distance_files/journal.css">
  <link href="https://jeiwan.net/index.xml" rel="alternate" type="application/rss+xml" title="Going the distance">

  

  

</head>

<body>
  <div class="container">

    <nav class="site-nav">
      <a href="https://jeiwan.net/">Index</a>
    </nav>


<article class="post">
  <header class="post-header">
    <h1 class="post-title">Building Blockchain in Go. Part 3: Persistence and CLI</h1>
    <time class="post-date" datetime=" 2017-08-29 12:10:04 +07">29 Aug 2017</time>
  </header>

  <blockquote>
<p>Chinese translations: <a href="https://github.com/liuchengxu/blockchain-tutorial/blob/master/content/part-3/persistence-and-cli.md">by liuchengxu</a>, <a href="https://zhangli1.gitbooks.io/dummies-for-blockchain/content/">by zhangli1</a>.</p>
</blockquote>
<h2 id="introduction">Introduction</h2>
<p><a href="https://jeiwan.net/posts/building-blockchain-in-go-part-1/">So</a> <a href="https://jeiwan.net/posts/building-blockchain-in-go-part-2/">far</a>,
 we’ve built a blockchain with a proof-of-work system, which makes 
mining possible. Our implementation is getting closer to a fully 
functional blockchain, but it still lacks some important features. Today
 will start storing a blockchain in a database, and after that we’ll 
make a simple command-line interface to perform operations with the 
blockchain. In its essence, blockchain is a distributed database. We’re 
going to omit the “distributed” part for now and focus on the “database”
 part.</p>
<h2 id="database-choice">Database Choice</h2>
<p>Currently, there’s no database in our implementation; instead, we 
create blocks every time we run the program and store them in memory. We
 cannot reuse a blockchain, we cannot share it with others, thus we need
 to store it on the disk.</p>
<p>Which database do we need? Actually, any of them. In <a href="https://bitcoin.org/bitcoin.pdf">the original Bitcoin paper</a>, nothing is said about using a certain database, so it’s up to a developer what DB to use. <a href="https://github.com/bitcoin/bitcoin">Bitcoin Core</a>, which was initially published by Satoshi Nakamoto and which is currently a reference implementation of Bitcoin, uses <a href="https://github.com/google/leveldb">LevelDB</a> (although it was introduced to the client only in 2012). And we’ll use…</p>
<h2 id="boltdb">BoltDB</h2>
<p>Because:</p>
<ol>
<li>It’s simple and minimalistic.</li>
<li>It’s implemented in Go.</li>
<li>It doesn’t require to run a server.</li>
<li>It allows to build the data structure we want.</li>
</ol>
<p>From the BoltDB’s <a href="https://github.com/boltdb/bolt">README on Github</a>:</p>
<blockquote>
<p>Bolt is a pure Go key/value store inspired by Howard Chu’s LMDB 
project. The goal of the project is to provide a simple, fast, and 
reliable database for projects that don’t require a full database server
 such as Postgres or MySQL.</p>
</blockquote>
<blockquote>
<p>Since Bolt is meant to be used as such a low-level piece of 
functionality, simplicity is key. The API will be small and only focus 
on getting values and setting values. That’s it.</p>
</blockquote>
<p>Sounds perfect for our needs! Let’s spend a minute reviewing it.</p>
<p>BoltDB is a key/value storage, which means there’re no tables like in
 SQL RDBMS (MySQL, PostgreSQL, etc.), no rows, no columns. Instead, data
 is stored as key-value pairs (like in Golang maps). Key-value pairs are
 stored in buckets, which are intended to group similar pairs (this is 
similar to tables in RDBMS). Thus, in order to get a value, you need to 
know a bucket and a key.</p>
<p>One important thing about BoltDB is that there are no data types: 
keys and values are byte arrays. Since we’ll store Go structs (<code>Block</code>,
 in particular) in it, we’ll need to serialize them, i.e. implement a 
mechanism of converting a Go struct into a byte array and restoring it 
back from a byte array. We’ll use <a href="https://golang.org/pkg/encoding/gob/">encoding/gob</a> for this, but <code>JSON</code>, <code>XML</code>, <code>Protocol Buffers</code>, etc. can be used as well. We’re using <code>encoding/gob</code> because it’s simple and is a part of the standard Go library.</p>
<h2 id="database-structure">Database Structure</h2>
<p>Before starting implementing persistence logic, we first need to 
decide how we’ll store data in the DB. And for this, we’ll refer to the 
way Bitcoin Core does that.</p>
<p>In simple words, Bitcoin Core uses two “buckets” to store data:</p>
<ol>
<li><code>blocks</code> stores metadata describing all the blocks in a chain.</li>
<li><code>chainstate</code> stores the state of a chain, which is all currently unspent transaction outputs and some metadata.</li>
</ol>
<p>Also, blocks are stored as separate files on the disk. This is done 
for a performance purpose: reading a single block won’t require loading 
all (or some) of them into memory. We won’t implement this.</p>
<p>In <code>blocks</code>, the <code>key -&gt; value</code> pairs are:</p>
<ol>
<li><code>'b' + 32-byte block hash -&gt; block index record</code></li>
<li><code>'f' + 4-byte file number -&gt; file information record</code></li>
<li><code>'l' -&gt; 4-byte file number: the last block file number used</code></li>
<li><code>'R' -&gt; 1-byte boolean: whether we're in the process of reindexing</code></li>
<li><code>'F' + 1-byte flag name length + flag name string -&gt; 1 byte boolean: various flags that can be on or off</code></li>
<li><code>'t' + 32-byte transaction hash -&gt; transaction index record</code></li>
</ol>
<p>In <code>chainstate</code>, the <code>key -&gt; value</code> pairs are:</p>
<ol>
<li><code>'c' + 32-byte transaction hash -&gt; unspent transaction output record for that transaction</code></li>
<li><code>'B' -&gt; 32-byte block hash: the block hash up to which the database represents the unspent transaction outputs</code></li>
</ol>
<p><em>(Detailed explanation can be found <a href="https://en.bitcoin.it/wiki/Bitcoin_Core_0.11_(ch_2):_Data_Storage">here</a>)</em></p>
<p>Since we don’t have transactions yet, we’re going to have only <code>blocks</code>
 bucket. Also, as said above, we will store the whole DB as a single 
file, without storing blocks in separate files. So we won’t need 
anything related to file numbers. So these are <code>key -&gt; value</code> pairs we’ll use:</p>
<ol>
<li><code>32-byte block-hash -&gt; Block structure (serialized)</code></li>
<li><code>'l' -&gt; the hash of the last block in a chain</code></li>
</ol>
<p>That’s all we need to know to start implementing the persistence mechanism.</p>
<h2 id="serialization">Serialization</h2>
<p>As said before, in BoltDB values can be only of <code>[]byte</code> type, and we want to store <code>Block</code> structs in the DB. We’ll use <a href="https://golang.org/pkg/encoding/gob/">encoding/gob</a> to serialize the structs.</p>
<p>Let’s implement <code>Serialize</code> method of <code>Block</code> (errors processing is omitted for brevity):</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Block<span class="token punctuation">)</span> <span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> result bytes<span class="token punctuation">.</span>Buffer
	encoder <span class="token operator">:=</span> gob<span class="token punctuation">.</span><span class="token function">NewEncoder</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">)</span>

	err <span class="token operator">:=</span> encoder<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>

	<span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The piece is straightforward: at first, we declare a buffer that will store serialized data; then we initialize a <code>gob</code> encoder and encode the block; the result is returned as a byte array.</p>
<p>Next, we need a deserializing function that will receive a byte array as input and return a <code>Block</code>. This won’t be a method but an independent function:</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">func</span> <span class="token function">DeserializeBlock</span><span class="token punctuation">(</span>d <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token operator">*</span>Block <span class="token punctuation">{</span>
	<span class="token keyword">var</span> block Block

	decoder <span class="token operator">:=</span> gob<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span>
	err <span class="token operator">:=</span> decoder<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>block<span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token operator">&amp;</span>block
<span class="token punctuation">}</span>
</code></pre></div><p>And that’s it for the serialization!</p>
<h2 id="persistence">Persistence</h2>
<p>Let’s start with the <code>NewBlockchain</code> function. Currently, it creates a new instance of <code>Blockchain</code> and adds the genesis block to it. What we want it to do is to:</p>
<ol>
<li>Open a DB file.</li>
<li>Check if there’s a blockchain stored in it.</li>
<li>If there’s a blockchain:
<ol>
<li>Create a new <code>Blockchain</code> instance.</li>
<li>Set the tip of the <code>Blockchain</code> instance to the last block hash stored in the DB.</li>
</ol>
</li>
<li>If there’s no existing blockchain:
<ol>
<li>Create the genesis block.</li>
<li>Store in the DB.</li>
<li>Save the genesis block’s hash as the last block hash.</li>
<li>Create a new <code>Blockchain</code> instance with its tip pointing at the genesis block.</li>
</ol>
</li>
</ol>
<p>In code, it looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">func</span> <span class="token function">NewBlockchain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Blockchain <span class="token punctuation">{</span>
	<span class="token keyword">var</span> tip <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> bolt<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>dbFile<span class="token punctuation">,</span> <span class="token number">0600</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

	err <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>bolt<span class="token punctuation">.</span>Tx<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
		b <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Bucket</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>blocksBucket<span class="token punctuation">)</span><span class="token punctuation">)</span>

		<span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			genesis <span class="token operator">:=</span> <span class="token function">NewGenesisBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			b<span class="token punctuation">,</span> err <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">CreateBucket</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>blocksBucket<span class="token punctuation">)</span><span class="token punctuation">)</span>
			err <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>genesis<span class="token punctuation">.</span>Hash<span class="token punctuation">,</span> genesis<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			err <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> genesis<span class="token punctuation">.</span>Hash<span class="token punctuation">)</span>
			tip <span class="token operator">=</span> genesis<span class="token punctuation">.</span>Hash
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			tip <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	bc <span class="token operator">:=</span> Blockchain<span class="token punctuation">{</span>tip<span class="token punctuation">,</span> db<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token operator">&amp;</span>bc
<span class="token punctuation">}</span>
</code></pre></div><p>Let’s review this piece by piece.</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go">db<span class="token punctuation">,</span> err <span class="token operator">:=</span> bolt<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>dbFile<span class="token punctuation">,</span> <span class="token number">0600</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
</code></pre></div><p>This is a standard way of opening a BoltDB file. Notice that it won’t return an error if there’s no such file.</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go">err <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>bolt<span class="token punctuation">.</span>Tx<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
<span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>In BoltDB, operations with a database are run 
within a transaction. And there are two types of transactions: read-only
 and read-write. Here, we open a read-write transaction (<code>db.Update(...)</code>), because we expect to put the genesis block in the DB.</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go">b <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Bucket</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>blocksBucket<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
	genesis <span class="token operator">:=</span> <span class="token function">NewGenesisBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	b<span class="token punctuation">,</span> err <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">CreateBucket</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>blocksBucket<span class="token punctuation">)</span><span class="token punctuation">)</span>
	err <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>genesis<span class="token punctuation">.</span>Hash<span class="token punctuation">,</span> genesis<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	err <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> genesis<span class="token punctuation">.</span>Hash<span class="token punctuation">)</span>
	tip <span class="token operator">=</span> genesis<span class="token punctuation">.</span>Hash
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	tip <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This is the core of the function. Here, we obtain the bucket storing our blocks: if it exists, we read the <code>l</code> key from it; if it doesn’t exist, we generate the genesis block, create the bucket, save the block into it, and update the <code>l</code> key storing the last block hash of the chain.</p>
<p>Also, notice the new way of creating a <code>Blockchain</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go">bc <span class="token operator">:=</span> Blockchain<span class="token punctuation">{</span>tip<span class="token punctuation">,</span> db<span class="token punctuation">}</span>
</code></pre></div><p>We don’t store all the blocks in it anymore, 
instead only the tip of the chain is stored. Also, we store a DB 
connection, because we want to open it once and keep it open while the 
program is running. Thus, the <code>Blockchain</code> structure now looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">type</span> Blockchain <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	tip <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
	db  <span class="token operator">*</span>bolt<span class="token punctuation">.</span>DB
<span class="token punctuation">}</span>
</code></pre></div><p>Next thing we want to update is the <code>AddBlock</code> method: adding blocks to a chain now is not as easy as adding an element to an array. From now on we’ll store blocks in the DB:</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">func</span> <span class="token punctuation">(</span>bc <span class="token operator">*</span>Blockchain<span class="token punctuation">)</span> <span class="token function">AddBlock</span><span class="token punctuation">(</span>data <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> lastHash <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>

	err <span class="token operator">:=</span> bc<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>bolt<span class="token punctuation">.</span>Tx<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
		b <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Bucket</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>blocksBucket<span class="token punctuation">)</span><span class="token punctuation">)</span>
		lastHash <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	newBlock <span class="token operator">:=</span> <span class="token function">NewBlock</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> lastHash<span class="token punctuation">)</span>

	err <span class="token operator">=</span> bc<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>bolt<span class="token punctuation">.</span>Tx<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
		b <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Bucket</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>blocksBucket<span class="token punctuation">)</span><span class="token punctuation">)</span>
		err <span class="token operator">:=</span> b<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>newBlock<span class="token punctuation">.</span>Hash<span class="token punctuation">,</span> newBlock<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		err <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newBlock<span class="token punctuation">.</span>Hash<span class="token punctuation">)</span>
		bc<span class="token punctuation">.</span>tip <span class="token operator">=</span> newBlock<span class="token punctuation">.</span>Hash

		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Let’s review this piece by piece:</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go">err <span class="token operator">:=</span> bc<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>bolt<span class="token punctuation">.</span>Tx<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	b <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Bucket</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>blocksBucket<span class="token punctuation">)</span><span class="token punctuation">)</span>
	lastHash <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>This is the other (read-only) type of BoltDB 
transactions. Here we get the last block hash from the DB to use it to 
mine a new block hash.</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go">newBlock <span class="token operator">:=</span> <span class="token function">NewBlock</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> lastHash<span class="token punctuation">)</span>
b <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Bucket</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>blocksBucket<span class="token punctuation">)</span><span class="token punctuation">)</span>
err <span class="token operator">:=</span> b<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>newBlock<span class="token punctuation">.</span>Hash<span class="token punctuation">,</span> newBlock<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
err <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newBlock<span class="token punctuation">.</span>Hash<span class="token punctuation">)</span>
bc<span class="token punctuation">.</span>tip <span class="token operator">=</span> newBlock<span class="token punctuation">.</span>Hash
</code></pre></div><p>After mining a new block, we save its serialized representation into the DB and update the <code>l</code> key, which now stores the new block’s hash.</p>
<p>Done! It wasn’t hard, was it?</p>
<h2 id="inspecting-blockchain">Inspecting Blockchain</h2>
<p>All new blocks are now saved in a database, so we can reopen a 
blockchain and add a new block to it. But after implementing this, we 
lost a nice feature: we cannot print out blockchain blocks anymore 
because we don’t store blocks in an array any longer. Let’s fix this 
flaw!</p>
<p>BoltDB allows to iterate over all the keys in a bucket, but the keys 
are stored in byte-sorted order, and we want blocks to be printed in the
 order they take in a blockchain. Also, because we don’t want to load 
all the blocks into memory (our blockchain DB could be huge!.. or let’s 
just pretend it could), we’ll read them one by one. For this purpose, 
we’ll need a blockchain iterator:</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">type</span> BlockchainIterator <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	currentHash <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
	db          <span class="token operator">*</span>bolt<span class="token punctuation">.</span>DB
<span class="token punctuation">}</span>
</code></pre></div><p>An iterator will be created each time we want to 
iterate over blocks in a blockchain and it’ll store the block hash of 
the current iteration and a connection to a DB. Because of the latter, 
an iterator is logically attached to a blockchain (it’s a <code>Blockchain</code> instance that stores a DB connection) and, thus, is created in a <code>Blockchain</code> method:</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">func</span> <span class="token punctuation">(</span>bc <span class="token operator">*</span>Blockchain<span class="token punctuation">)</span> <span class="token function">Iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>BlockchainIterator <span class="token punctuation">{</span>
	bci <span class="token operator">:=</span> <span class="token operator">&amp;</span>BlockchainIterator<span class="token punctuation">{</span>bc<span class="token punctuation">.</span>tip<span class="token punctuation">,</span> bc<span class="token punctuation">.</span>db<span class="token punctuation">}</span>

	<span class="token keyword">return</span> bci
<span class="token punctuation">}</span>
</code></pre></div><p>Notice that an iterator initially points at the 
tip of a blockchain, thus blocks will be obtained from top to bottom, 
from newest to oldest. In fact, <strong>choosing a tip means “voting” for a blockchain</strong>.
 A blockchain can have multiple branches, and it’s the longest of them 
that’s considered main. After getting a tip (it can be any block in the 
blockchain) we can reconstruct the whole blockchain and find its length 
and the work required to build it. This fact also means that a tip is a 
kind of an identifier of a blockchain.</p>
<p><code>BlockchainIterator</code> will do only one thing: it’ll return the next block from a blockchain.</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">func</span> <span class="token punctuation">(</span>i <span class="token operator">*</span>BlockchainIterator<span class="token punctuation">)</span> <span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Block <span class="token punctuation">{</span>
	<span class="token keyword">var</span> block <span class="token operator">*</span>Block

	err <span class="token operator">:=</span> i<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>bolt<span class="token punctuation">.</span>Tx<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
		b <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Bucket</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>blocksBucket<span class="token punctuation">)</span><span class="token punctuation">)</span>
		encodedBlock <span class="token operator">:=</span> b<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>currentHash<span class="token punctuation">)</span>
		block <span class="token operator">=</span> <span class="token function">DeserializeBlock</span><span class="token punctuation">(</span>encodedBlock<span class="token punctuation">)</span>

		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	i<span class="token punctuation">.</span>currentHash <span class="token operator">=</span> block<span class="token punctuation">.</span>PrevBlockHash

	<span class="token keyword">return</span> block
<span class="token punctuation">}</span>
</code></pre></div><p>That’s it for the DB part!</p>
<h2 id="cli">CLI</h2>
<p>Until now our implementation hasn’t provided any interface to interact with the program: we’ve simply executed <code>NewBlockchain</code>, <code>bc.AddBlock</code> in the <code>main</code> function. Time to improve this! We want to have these commands:</p>
<pre tabindex="0"><code>blockchain_go addblock "Pay 0.031337 for a coffee"
blockchain_go printchain
</code></pre><p>All command-line related operations will be processed by the <code>CLI</code> struct:</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">type</span> CLI <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	bc <span class="token operator">*</span>Blockchain
<span class="token punctuation">}</span>
</code></pre></div><p>Its “entrypoint” is the <code>Run</code> function:</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">func</span> <span class="token punctuation">(</span>cli <span class="token operator">*</span>CLI<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	cli<span class="token punctuation">.</span><span class="token function">validateArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	addBlockCmd <span class="token operator">:=</span> flag<span class="token punctuation">.</span><span class="token function">NewFlagSet</span><span class="token punctuation">(</span><span class="token string">"addblock"</span><span class="token punctuation">,</span> flag<span class="token punctuation">.</span>ExitOnError<span class="token punctuation">)</span>
	printChainCmd <span class="token operator">:=</span> flag<span class="token punctuation">.</span><span class="token function">NewFlagSet</span><span class="token punctuation">(</span><span class="token string">"printchain"</span><span class="token punctuation">,</span> flag<span class="token punctuation">.</span>ExitOnError<span class="token punctuation">)</span>

	addBlockData <span class="token operator">:=</span> addBlockCmd<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"Block data"</span><span class="token punctuation">)</span>

	<span class="token keyword">switch</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token string">"addblock"</span><span class="token punctuation">:</span>
		err <span class="token operator">:=</span> addBlockCmd<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token string">"printchain"</span><span class="token punctuation">:</span>
		err <span class="token operator">:=</span> printChainCmd<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		cli<span class="token punctuation">.</span><span class="token function">printUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> addBlockCmd<span class="token punctuation">.</span><span class="token function">Parsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token operator">*</span>addBlockData <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{</span>
			addBlockCmd<span class="token punctuation">.</span><span class="token function">Usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		cli<span class="token punctuation">.</span><span class="token function">addBlock</span><span class="token punctuation">(</span><span class="token operator">*</span>addBlockData<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> printChainCmd<span class="token punctuation">.</span><span class="token function">Parsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		cli<span class="token punctuation">.</span><span class="token function">printChain</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We’re using the standard <a href="https://golang.org/pkg/flag/">flag</a> package to parse command-line arguments.</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go">addBlockCmd <span class="token operator">:=</span> flag<span class="token punctuation">.</span><span class="token function">NewFlagSet</span><span class="token punctuation">(</span><span class="token string">"addblock"</span><span class="token punctuation">,</span> flag<span class="token punctuation">.</span>ExitOnError<span class="token punctuation">)</span>
printChainCmd <span class="token operator">:=</span> flag<span class="token punctuation">.</span><span class="token function">NewFlagSet</span><span class="token punctuation">(</span><span class="token string">"printchain"</span><span class="token punctuation">,</span> flag<span class="token punctuation">.</span>ExitOnError<span class="token punctuation">)</span>
addBlockData <span class="token operator">:=</span> addBlockCmd<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"Block data"</span><span class="token punctuation">)</span>
</code></pre></div><p>First, we create two subcommands, <code>addblock</code> and <code>printchain</code>, then we add <code>-data</code> flag to the former. <code>printchain</code> won’t have any flags.</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">switch</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
<span class="token keyword">case</span> <span class="token string">"addblock"</span><span class="token punctuation">:</span>
	err <span class="token operator">:=</span> addBlockCmd<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">case</span> <span class="token string">"printchain"</span><span class="token punctuation">:</span>
	err <span class="token operator">:=</span> printChainCmd<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">default</span><span class="token punctuation">:</span>
	cli<span class="token punctuation">.</span><span class="token function">printUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Next we check the command provided by user and parse related <code>flag</code> subcommand.</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">if</span> addBlockCmd<span class="token punctuation">.</span><span class="token function">Parsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token operator">*</span>addBlockData <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{</span>
		addBlockCmd<span class="token punctuation">.</span><span class="token function">Usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	cli<span class="token punctuation">.</span><span class="token function">addBlock</span><span class="token punctuation">(</span><span class="token operator">*</span>addBlockData<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> printChainCmd<span class="token punctuation">.</span><span class="token function">Parsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	cli<span class="token punctuation">.</span><span class="token function">printChain</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Next we check which of the subcommands were parsed and run related functions.</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">func</span> <span class="token punctuation">(</span>cli <span class="token operator">*</span>CLI<span class="token punctuation">)</span> <span class="token function">addBlock</span><span class="token punctuation">(</span>data <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	cli<span class="token punctuation">.</span>bc<span class="token punctuation">.</span><span class="token function">AddBlock</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>cli <span class="token operator">*</span>CLI<span class="token punctuation">)</span> <span class="token function">printChain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	bci <span class="token operator">:=</span> cli<span class="token punctuation">.</span>bc<span class="token punctuation">.</span><span class="token function">Iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		block <span class="token operator">:=</span> bci<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Prev. hash: %x\n"</span><span class="token punctuation">,</span> block<span class="token punctuation">.</span>PrevBlockHash<span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Data: %s\n"</span><span class="token punctuation">,</span> block<span class="token punctuation">.</span>Data<span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Hash: %x\n"</span><span class="token punctuation">,</span> block<span class="token punctuation">.</span>Hash<span class="token punctuation">)</span>
		pow <span class="token operator">:=</span> <span class="token function">NewProofOfWork</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"PoW: %s\n"</span><span class="token punctuation">,</span> strconv<span class="token punctuation">.</span><span class="token function">FormatBool</span><span class="token punctuation">(</span>pow<span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span>PrevBlockHash<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
			<span class="token keyword">break</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This piece is very similar to the one we had before. The only difference is that we’re now using a <code>BlockchainIterator</code> to iterate over blocks in a blockchain.</p>
<p>Also let’s not forget to modify the <code>main</code> function accordingly:</p>
<div class="highlight"><pre tabindex="0" class="chroma language-go"><code class=" language-go" data-lang="go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	bc <span class="token operator">:=</span> <span class="token function">NewBlockchain</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> bc<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	cli <span class="token operator">:=</span> CLI<span class="token punctuation">{</span>bc<span class="token punctuation">}</span>
	cli<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Note that a new <code>Blockchain</code> is created no matter what command-line arguments are provided.</p>
<p>And that’s it! Let’s check that everything works as expected:</p>
<div class="highlight"><pre tabindex="0" class="chroma language-shell"><code class=" language-shell" data-lang="shell">$ blockchain_go printchain
No existing blockchain found. Creating a new one<span class="token punctuation">..</span>.
Mining the block containing <span class="token string">"Genesis Block"</span>
000000edc4a82659cebf087adee1ea353bd57fcd59927662cd5ff1c4f618109b

Prev. hash:
Data: Genesis Block
Hash: 000000edc4a82659cebf087adee1ea353bd57fcd59927662cd5ff1c4f618109b
PoW: <span class="token boolean">true</span>

$ blockchain_go addblock -data <span class="token string">"Send 1 BTC to Ivan"</span>
Mining the block containing <span class="token string">"Send 1 BTC to Ivan"</span>
000000d7b0c76e1001cdc1fc866b95a481d23f3027d86901eaeb77ae6d002b13

Success<span class="token operator">!</span>

$ blockchain_go addblock -data <span class="token string">"Pay 0.31337 BTC for a coffee"</span>
Mining the block containing <span class="token string">"Pay 0.31337 BTC for a coffee"</span>
000000aa0748da7367dec6b9de5027f4fae0963df89ff39d8f20fd7299307148

Success<span class="token operator">!</span>

$ blockchain_go printchain
Prev. hash: 000000d7b0c76e1001cdc1fc866b95a481d23f3027d86901eaeb77ae6d002b13
Data: Pay <span class="token number">0.31337</span> BTC <span class="token keyword">for</span> a coffee
Hash: 000000aa0748da7367dec6b9de5027f4fae0963df89ff39d8f20fd7299307148
PoW: <span class="token boolean">true</span>

Prev. hash: 000000edc4a82659cebf087adee1ea353bd57fcd59927662cd5ff1c4f618109b
Data: Send <span class="token number">1</span> BTC to Ivan
Hash: 000000d7b0c76e1001cdc1fc866b95a481d23f3027d86901eaeb77ae6d002b13
PoW: <span class="token boolean">true</span>

Prev. hash:
Data: Genesis Block
Hash: 000000edc4a82659cebf087adee1ea353bd57fcd59927662cd5ff1c4f618109b
PoW: <span class="token boolean">true</span>
</code></pre></div><p><em>(sound of a beer can opening)</em></p>
<h2 id="conclusion">Conclusion</h2>
<p>Next time we’ll implement addresses, wallets, and (probably) transactions. So stay tuned!</p>
<h2 id="links">Links</h2>
<ol>
<li><a href="https://github.com/Jeiwan/blockchain_go/tree/part_3">Full source codes</a></li>
<li><a href="https://en.bitcoin.it/wiki/Bitcoin_Core_0.11_(ch_2):_Data_Storage">Bitcoin Core Data Storage</a></li>
<li><a href="https://github.com/boltdb/bolt">boltdb</a></li>
<li><a href="https://golang.org/pkg/encoding/gob/">encoding/gob</a></li>
<li><a href="https://golang.org/pkg/flag/">flag</a></li>
</ol>


</article>

<hr>
<br>






      <footer class="site-footer">
        <span itemscope="" itemtype="http://schema.org/Person">
          <link itemprop="url" href="https://jeiwan.net/">

          Author:
          <span itemprop="name">Ivan Kuznetsov</span>

          <br>

          Get in touch:

          <a itemprop="sameAs" href="mailto:me@jeiwan.ru" target="_blank">E-mail</a>

          <a itemprop="sameAs" href="https://t.me/jeiwan" title="Telegram" target="_blank">Telegram</a>

          <a itemprop="sameAs" href="https://twitter.com/jeiwan7" title="Twitter" target="_blank">Twitter</a>

          <a itemprop="sameAs" href="https://github.com/jeiwan" title="GitHub" target="_blank">GitHub</a>

          
        </span>

        <br><br>

        <div style="text-align:center">
          <small>
            <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="Building%20Blockchain%20in%20Go.%20Part%203%20Persistence%20and%20CLI%20-%20Going%20the%20distance_files/88x31.png"></a><br>Content of this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
          </small>
        </div>

        
      </footer>
    </div>

  

    <script src="Building%20Blockchain%20in%20Go.%20Part%203%20Persistence%20and%20CLI%20-%20Going%20the%20distance_files/prism.js"></script>

  

</body></html>